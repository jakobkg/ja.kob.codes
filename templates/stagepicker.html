<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
      body {
        background-color: linen;
      }
      .btn {
        margin: 10px;
        width: 250px;
        height: 150px;
      }
      .btn.fd {
        background: url("{{ url_for("static", filename="img/finaldestination.jpg") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      .btn.sv {
        background: url("{{ url_for("static", filename="img/smashville.png") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      .btn.sbf {
        background: url("{{ url_for("static", filename="img/smallbattlefield.jpg") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      .btn.bf {
        background: url("{{ url_for("static", filename="img/battlefield.png") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      .btn.town {
        background: url("{{ url_for("static", filename="img/town.jpg") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      .btn.lylat {
        background: url("{{ url_for("static", filename="img/lylat.jpg") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      .btn.yoshis {
        background: url("{{ url_for("static", filename="img/yoshistory.png") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      .btn.kalos {
        background: url("{{ url_for("static", filename="img/kalos.png") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      .btn.ps2 {
        background: url("{{ url_for("static", filename="img/stadium2.png") }}")
          no-repeat scroll 50% 0 transparent;
        
        background-size: cover;
      }
      button[data-struckby='1'] {
        border: 4px solid;
        border-color: #ff0000;
        cursor: not-allowed;
        -webkit-filter: brightness(70%);
        filter: brightness(70%);
      }
      button[data-struckby='2'] {
        border: 4px solid;
        border-color: #0000ff;
        cursor: not-allowed;
        -webkit-filter: brightness(70%);
        filter: brightness(70%);
      }
      button[chosen="true"] {
        width: 50%;
        padding-top: 30%;
      }
      button[data-struckby='DSR'] {
        -webkit-filter: brightness(50%);
        filter: brightness(50%);
        border: 4px solid;
        border-color: #CCCCCC;
      }
    </style>
    <title>Banevalg</title>
  </head>
  <body>
    <script>
      var currentPlayer;
      var currentGame = 1;
      var player1lastWonStage;
      var player2lastWonStage;
      var struckStages = new Array();
      var chosenStage;

      var fullStageList = `<div class="d-flex justify-content-center">
        <button class="btn btn-primary fd" title="Final Destination" onclick="strikeStage('fd')"></button>
        <button class="btn btn-primary sv" title="Smashville" onclick="strikeStage('sv')"></button>
        <button class="btn btn-primary sbf" title="Small Battlefield" onclick="strikeStage('sbf')"></button>
      </div>
      <div class="d-flex justify-content-center">
        <button class="btn btn-primary bf" title="Battlefield" onclick="strikeStage('bf')"></button>
        <button class="btn btn-primary town" title="Town and City" onclick="strikeStage('town')"></button>
        <button class="btn btn-primary lylat" title="Lylat Cruise" onclick="strikeStage('lylat')"></button>
      </div>
      <div class="d-flex justify-content-center">
        <button class="btn btn-primary yoshis" title="Yoshi's Story" onclick="strikeStage('yoshis')"></button>
        <button class="btn btn-primary kalos" title="Kalos Pokémon League" onclick="strikeStage('kalos')"></button>
        <button class="btn btn-primary ps2" title="Pokémon Stadium 2" onclick="strikeStage('ps2')"></button>
      </div>`

      document.addEventListener('DOMContentLoaded', function() {
        var d = new Date();
        var s = d.getMilliseconds();
        var player = document.getElementById("currentPlayer");
        if (s % 2 == 1) {
          player.setAttribute("style", "color:crimson");
          player.innerHTML = "Spiller 1";
          currentPlayer = 1;
        } else {
          player.setAttribute("style", "color:dodgerblue");
          player.innerHTML = "Spiller 2";
          currentPlayer = 2;
        }
      }, false);

      function changePlayer() {
        var player = document.getElementById("currentPlayer");
        if (currentPlayer == 1) {
          currentPlayer = 2;
          player.setAttribute("style", "color:dodgerblue");
          player.innerHTML = "Spiller 2";
        } else {
          currentPlayer = 1;
          player.setAttribute("style", "color:crimson");
          player.innerHTML = "Spiller 1";
        }
      }

      function loadNextGame(prevWinner) {
        currentGame++;
        currentPlayer = prevWinner;

        struckStages = [];

        var player = document.getElementById("currentPlayer");

        if (currentPlayer == 1) {
          player.setAttribute("style", "color:crimson");
          player.innerHTML = "Spiller 1";
          player1lastWonStage = chosenStage;
        } else {
          player.setAttribute("style", "color:dodgerblue");
          player.innerHTML = "Spiller 2";
          player2lastWonStage = chosenStage;
        }
        
        toptext.innerHTML = ", velg to baner du <i>ikke</i> vil spille på";

        document.getElementById("btn_container").innerHTML = fullStageList;

        // mDSR baby
        if (prevWinner == 1) {
          if (player2lastWonStage !== 'undefined') {
            document.getElementsByClassName(player2lastWonStage)[0].setAttribute("data-struckby", "DSR");
          }
        } else {
          if (player1lastWonStage !== 'undefined') {
            document.getElementsByClassName(player1lastWonStage)[0].setAttribute("data-struckby", "DSR");
          }
        }
      }

      function selectStage(stage) {
        if (struckStages.includes(stage)) {
          return;
        }
        chosenStage = stage;
        var keep = document.getElementsByClassName(stage).item(0);
        keep.setAttribute("chosen", "true");
        keep.setAttribute("onclick", "");
        var p1won = "<button class='btn' onclick='loadNextGame(1)' style='background-color:crimson'><h4 style='color:white'>Spiller 1</h4></button>"
        var p2won = "<button class='btn' onclick='loadNextGame(2)' style='background-color:dodgerblue'><h4 style='color:white'>Spiller 2</h4></button>"
        document.getElementById("btn_container").innerHTML = "<div class='d-flex justify-content-center'>" + keep.outerHTML + "</div>";
        document.getElementById("btn_container").innerHTML += "<div class='d-flex justify-content-center'><h3>Hvem vant?</h3></div>";
        document.getElementById("btn_container").innerHTML += "<div class='d-flex justify-content-center'>" + p1won + p2won + "</div>";

        toptext = document.getElementById("toptext");
        toptext.innerHTML = " valgte " + keep.getAttribute("title");
      }

      function strikeStage(stage) {
        var clickedStage = document.getElementsByClassName(stage)[0];
        if (clickedStage.hasAttribute("data-struckby")) {
          return;
        }

        if (currentPlayer == 1) {
            clickedStage.setAttribute("data-struckby", "1");
            clickedStage.setAttribute("data-struck", "true");
        } else {
            clickedStage.setAttribute("data-struckby", "2");
            clickedStage.setAttribute("data-struck", "true");
        }

        struckStages.push(stage);
        toptext = document.getElementById("toptext");

        if (currentGame == 1) {
          if (struckStages.length == 1) {
            changePlayer();
            toptext.innerHTML = ", velg to baner du <i>ikke</i> vil spille på";
          } else
          if (struckStages.length == 3) {
            changePlayer();
            toptext.innerHTML = ", velg banen dere skal spille game 1 på";
            buttons = document.getElementsByTagName("button");
            for (let index = 0; index < buttons.length; index++) {
              const button = buttons[index];
              thisStage = button.getAttribute("class").split(" ").slice(-1)[0];
              button.setAttribute("onclick", "selectStage('" + thisStage + "')");
            }
          }
        } else {
          if (struckStages.length == 2) {
            changePlayer();
            toptext.innerHTML = ", velg banen dere skal spille  game " + currentGame + " på";
            buttons = document.getElementsByTagName("button");
            for (let index = 0; index < buttons.length; index++) {
              const button = buttons[index];
              thisStage = button.getAttribute("class").split(" ").slice(-1)[0];
              button.setAttribute("onclick", "selectStage('" + thisStage + "')");
            }
        }
    }
      }
    </script>
    <div id="info" class="d-flex justify-content-center">
      <h2 class="justify-content-center"><span id="currentPlayer"></span><span id="toptext">, velg en bane du <i>ikke</i> vil spille på</span></h2>
    </div>
    <div id="btn_container">
      <div class="d-flex justify-content-center">
        <button class="btn btn-primary fd" title="Final Destination" onclick="strikeStage('fd')"></button>
        <button class="btn btn-primary sv" title="Smashville" onclick="strikeStage('sv')"></button>
        <button class="btn btn-primary sbf" title="Small Battlefield" onclick="strikeStage('sbf')"></button>
      </div>
      <div class="d-flex justify-content-center">
        <button class="btn btn-primary bf" title="Battlefield" onclick="strikeStage('bf')"></button>
        <button class="btn btn-primary town" title="Town and City" onclick="strikeStage('town')"></button>
      </div>
    </div>
  </body>
</html>
